#!/usr/bin/env node
'use strict';

const fs = require('fs/promises');
const yargs = require('yargs/yargs');
const { hideBin } = require('yargs/helpers');
const { dictMaker } = require('../lib/index');

(async () => {
  const argv = await yargs(hideBin(process.argv)).option('dist', {
    type: 'string',
    description: '出力先',
  }).option('win', {
    type: 'boolean',
    description: 'Windows10標準IME向け辞書データの書き出し',
  }).option('winGoogle', {
    type: 'boolean',
    description: 'Windows10 GoogleIME向け辞書データの書き出し',
  }).option('mac', {
    type: 'boolean',
    description: 'macOS向け辞書データの書き出し',
  }).argv;
  const data = typeof argv._[0] === 'string' && await fs.readFile(argv._[0], {
    encoding: 'utf-8',
  }) || '[]';
  const getData = () => {
    const result = JSON.parse(data);

    if (!Array.isArray(result)) {
      throw new Error("JSON format is invalid.");
    }

    return result;
  }


  if (argv.win) {
    dictMaker(getData(), 'win', argv.dist);
  }

  if (argv.winGoogle) {
    dictMaker(getData(), 'win-google', argv.dist);
  }

  if (argv.mac) {
    dictMaker(getData(), 'mac', argv.dist);
  }
})();
